name: AutoIssueSync Workflow

on:
  push:
    branches:
      - master

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
    - name: Check out code
      uses: actions/checkout@v3

    - name: Setup .NET Core
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '6.0.x'

    # Restaurar dependencias
    - name: Restore dependencies
      run: dotnet restore

    # Construir el proyecto de análisis para generar el archivo `issues.json`
    - name: Build and Run AutoIssueSync.Analyzer
      run: dotnet build AutoIssueSync.Analyzer/AutoIssueSync.Analyzer.csproj --configuration Release && dotnet AutoIssueSync.Analyzer/bin/Release/net6.0/AutoIssueSync.Analyzer.dll ../AutoIssueSyncDemo

    # Asegúrate de que el archivo `issues.json` esté en la ruta correcta
    - name: Move issues.json
      run: mv AutoIssueSync.Analyzer/issues.json issues.json

    # Construir el proyecto de sincronización
    - name: Build AutoIssueSync.Sync
      run: dotnet build AutoIssueSync.Sync/AutoIssueSync.Sync.csproj --configuration Release

    # Ejecutar la sincronización de issues con GitHub
    - name: Run Issue Sync
      run: dotnet AutoIssueSync.Sync/bin/Release/net6.0/AutoIssueSync.Sync.dll ./issues.json
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

